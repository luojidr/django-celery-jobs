(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e450e"],{9067:function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:" app-container"},[o("el-form",{staticClass:"demo-form-inline",attrs:{inline:"",model:e.jobQuery}},[o("el-form-item",{attrs:{label:"任务标题"}},[o("el-input",{attrs:{size:"small",clearable:"",placeholder:"任务标题"},model:{value:e.jobQuery.title,callback:function(t){e.$set(e.jobQuery,"title",t)},expression:"jobQuery.title"}})],1),o("el-form-item",{staticClass:"inline-query-item",attrs:{label:"描述"}},[o("el-input",{attrs:{size:"small",clearable:"",placeholder:"任务描述"},model:{value:e.jobQuery.remark,callback:function(t){e.$set(e.jobQuery,"remark",t)},expression:"jobQuery.remark"}})],1),o("el-form-item",{staticClass:"inline-query-item"},[o("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"small"},on:{click:function(t){return e.getJobList(1)}}},[e._v(" 搜索 ")])],1)],1),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.jobList,"element-loading-text":"Loading",border:"","highlight-current-row":"","header-cell-style":{background:"#eef1f6",color:"#606266"}}},[o("el-table-column",{attrs:{prop:"id",align:"center",label:"ID",width:"80"}}),o("el-table-column",{attrs:{prop:"title",align:"center",label:"任务标题"}}),o("el-table-column",{attrs:{prop:"cron_expr",align:"center",label:"Cron表达式"}}),o("el-table-column",{attrs:{prop:"is_enabled",align:"center",label:"任务状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.is_enabled?o("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("已启用")]):o("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("已暂停")])]}}])}),o("el-table-column",{attrs:{prop:"max_run_cnt",align:"center",label:"最大执行次数"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.max_run_cnt?o("span",{domProps:{textContent:e._s(t.row.max_run_cnt)}}):o("span",[e._v("无限")]),o("span",[e._v("次")])]}}])}),o("el-table-column",{attrs:{prop:"first_run_time",align:"center",label:"首次运行时间"}}),o("el-table-column",{attrs:{prop:"deadline_run_time",align:"center",label:"截止运行时间"}}),o("el-table-column",{attrs:{prop:"remark",align:"center",label:"备注"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-popover",{attrs:{placement:"top-start",trigger:"hover",width:"300","popper-class":"row-column-popover"}},[o("div",{domProps:{innerHTML:e._s(t.row.remark)}}),o("span",{staticClass:"hidden-text",attrs:{slot:"reference"},domProps:{textContent:e._s(t.row.remark)},slot:"reference"})])]}}])}),o("el-table-column",{attrs:{prop:"",align:"center","class-name":"table-operation",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-link",{attrs:{underline:!1,type:"success",size:"small"},on:{click:function(o){return e.editJob(t.row,"update")}}},[e._v(" 编辑 ")]),t.row.is_enabled?o("el-link",{attrs:{underline:!1,type:"warning",size:"small"},on:{click:function(o){return e.editJob(t.row,"set_enabled")}}},[e._v(" 暂停 ")]):o("el-link",{attrs:{underline:!1,type:"warning",size:"small"},on:{click:function(o){return e.editJob(t.row,"set_enabled")}}},[e._v(" 启用 ")]),o("el-link",{attrs:{underline:!1,type:"danger",size:"small"},on:{click:function(o){return e.editJob(t.row,"delete")}}},[e._v(" 删除 ")]),e._v(" | "),o("el-link",{attrs:{underline:!1,type:"success",size:"small"},on:{click:function(o){return e.runCornRunTime(t.row)}}},[e._v(" 运行时间 ")])]}}])})],1),o("div",{staticClass:"pagination"},[o("el-pagination",{attrs:{"current-page":e.jobQuery.page,"page-size":10,layout:"total, prev, pager, next, jumper",total:e.jobQuery.totalCount},on:{"current-change":e.handleCurrentChange}})],1),o("DialogCronBox",{attrs:{dialogVisible:e.dialogVisible,expr:e.dialogCronExpression,maxRunCnt:e.dialogMaxRunCnt},on:{setDialogVisible:e.setDialogVisible}}),e.dialogJobVisible?o("el-dialog",{attrs:{title:e.dialogJobTitle,visible:e.dialogJobVisible,center:"","append-to-body":"","close-on-click-modal":!1,width:"60%",visibile:e.dialogJobVisible},on:{"update:visible":function(t){e.dialogJobVisible=t},close:function(t){e.dialogJobVisible=!1},"update:visibile":function(t){e.dialogJobVisible=t}}},[o("el-form",{staticClass:"demo-form-inline dialog-form-wrap",attrs:{model:e.jobForm,"label-width":"80px"}},[o("el-form-item",{attrs:{label:"原生任务"}},[o("el-input",{attrs:{placeholder:"原生任务",readonly:""},model:{value:e.jobForm.native_task_name,callback:function(t){e.$set(e.jobForm,"native_task_name",t)},expression:"jobForm.native_task_name"}})],1),o("el-form-item",{attrs:{label:"任务标题"}},[o("el-input",{attrs:{size:"small",clearable:"",placeholder:"任务标题"},model:{value:e.jobForm.title,callback:function(t){e.$set(e.jobForm,"title",t)},expression:"jobForm.title"}})],1),o("el-form-item",{attrs:{label:"备注"}},[o("el-input",{attrs:{size:"small",placeholder:"备注"},model:{value:e.jobForm.remark,callback:function(t){e.$set(e.jobForm,"remark",t)},expression:"jobForm.remark"}})],1),o("el-form-item",{attrs:{label:"任务定时"}},[o("crontab",{attrs:{cronExpression:e.jobForm.cron_expr},on:{setCronExpression:e.setCronExpression}})],1),o("el-form-item",{attrs:{label:"运行次数"}},[o("el-input-number",{staticClass:"form-input-number",attrs:{min:0,max:1e3,size:"medium",label:"执行次数"},model:{value:e.jobForm.max_run_cnt,callback:function(t){e.$set(e.jobForm,"max_run_cnt",t)},expression:"jobForm.max_run_cnt"}}),o("span",{staticClass:"alert-info"},[o("i",{staticClass:"el-icon-warning-outline"}),e._v(" 定时任务执行的最大次数，0默认无限次")])],1),o("el-form-item",{attrs:{label:"Cron表达式"}},[o("el-input",{attrs:{placeholder:"* * * * *",readonly:""},model:{value:e.jobForm.cron_expr,callback:function(t){e.$set(e.jobForm,"cron_expr",t)},expression:"jobForm.cron_expr"}})],1)],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogJobVisible=!1}}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.updatePeriodicJob}},[e._v("确 定")])],1)],1):e._e()],1)},l=[],a=o("5530"),i=(o("8ba4"),o("a9e3"),o("76fe")),r=o("b9e3"),s=o("bdd0"),c={name:"EditTask",components:{DialogCronBox:r["a"],Crontab:s["a"]},data:function(){return{loading:!0,cronWidth:"100%",jobList:[],jobQuery:{title:"",remark:"",page:1,totalCount:10},dialogVisible:!1,dialogCronExpression:"",dialogMaxRunCnt:0,dialogJobTitle:"编辑定时任务",dialogJobVisible:!1,jobForm:{native_task_name:"",id:null,title:"",remark:"",max_run_cnt:0,cron_expr:"* * * * *"}}},mounted:function(){this.getJobList()},methods:{setDialogVisible:function(e){this.dialogVisible=e},setCronExpression:function(e){this.jobForm.cron_expr=e},getJobList:function(e){var t=this;this.loading=!0,Number.isInteger(e)&&(this.jobQuery.page=e),Object(i["c"])(this.jobQuery).then((function(e){t.jobList=e.data.results,t.jobQuery.totalCount=e.data.count,t.loading=!1}))},handleCurrentChange:function(e){this.getJobList(e)},runCornRunTime:function(e){this.dialogMaxRunCnt=e.max_run_cnt,this.dialogCronExpression=e.cron_expr,this.dialogVisible=!0},editJob:function(e,t){var o,n,l=this;(this.jobForm=Object(a["a"])(Object(a["a"])({},e),{},{action:t}),"update"===t)?this.dialogJobVisible=!0:("set_enabled"===t?(n="warning",o=e.is_enabled?"暂停":"启动",this.jobForm.is_enabled=!e.is_enabled):"delete"===t&&(n="error",o="删除"),this.$confirm("确认".concat(o,"该任务？"),"提醒",{confirmButtonText:"确定",cancelButtonText:"取消",type:n}).then((function(){l.updatePeriodicJob()})).catch((function(){l.$message.warning("已取消".concat(o,"该任务！"))})))},updatePeriodicJob:function(){var e=this;Object(i["f"])(this.jobForm).then((function(t){200!==t.code?e.$message.error("操作定时任务失败: ".concat(t.message)):(e.dialogJobVisible=!1,e.getJobList())}))}}},u=c,b=o("2877"),m=Object(b["a"])(u,n,l,!1,null,"0f04738b",null);t["default"]=m.exports}}]);